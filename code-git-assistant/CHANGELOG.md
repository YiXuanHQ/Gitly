# 更新日志

本文档记录 Git Assistant 的所有重要变更。

---

## [1.0.1] - 2025-12-03

> ♻️ **文档与配置同步**，确保 v1.0.1 版本的信息、目录结构与 VSIX 包一致。

### 文档更新 📚

- **全面文档同步**：
  - README.md / README_CN.md / PROJECT_OVERVIEW.md / PROJECT_DETAILS.md / QUICK_REFERENCE.md 等核心文档同步最新项目结构、依赖与数据流
  - docs/DEVELOPMENT.md / docs/QUICKSTART.md / docs/TESTING.md / docs/API.md 开发文档更新至 1.0.1
  - 所有文档统一版本号、更新日期为 2025-12-03
  - 文档间引用链接和版本信息保持一致

- **API 文档完善**：
  - 新增 `getBranchGraphSnapshot()` 方法说明（分支图快照获取）
  - 新增 `clearBranchGraphCache()` 方法说明（分支图缓存清理）
  - 更新 `getBranchGraph()` 方法说明，包含增量更新和持久化缓存特性

### 配置增强 ⚙️

- **新增配置选项**：
  - `git-assistant.defaultRemote` - 快速推送/拉取等操作时优先使用的远程名称（留空则自动选择）
  - 支持在 VS Code 设置中配置，快速推送/拉取可记忆默认远程仓库
  - 与远程仓库管理面板联动，更新默认远程时自动同步配置

- **配置文档更新**：
  - 所有文档中的配置说明已包含 `defaultRemote` 选项
  - 开发文档中的配置读取示例已更新

### 代码质量改进 🔧

- **统一错误处理系统**：
  - 新增 `ErrorHandler` 类，提供统一的错误处理接口
  - 自动识别常见 Git 错误类型（如 "not a git repository"、"CONFLICT"、"permission denied" 等）
  - 提供针对性的错误提示和解决建议
  - 支持静默处理非关键错误

- **统一日志系统**：
  - 新增 `Logger` 类，替换所有 `console.*` 调用
  - 所有日志输出到 VS Code 的 "Git Assistant" 输出通道
  - 支持调试模式，`debug` 方法仅在配置启用时输出
  - 自动添加时间戳和日志级别

- **代码复用优化**：
  - 新增 `git-helpers.ts` 工具模块，提取公共函数
  - `pickRemote()` - 选择远程仓库（消除代码重复）
  - `getDefaultRemote()` - 获取默认远程仓库名称
  - `getCurrentBranch()` - 验证并获取当前分支
  - 提高代码可维护性和一致性

- **类型安全改进**：
  - 完善 `src/types/git.ts` 类型定义
  - 扩展 `BranchGraphData`、`RemoteInfo`、`RepositoryInfo`、`GitData` 等完整类型
  - 减少 `any` 类型使用，提高代码的类型安全性

- **内存管理优化**：
  - 实现缓存大小限制（MAX_CACHE_SIZE = 100），防止内存泄漏
  - 分支图存储索引限制（最多保留 20 个），自动清理旧数据
  - 分支图增量更新优化，限制查找次数，从最近开始查找

### 功能完善 ✨

- **控制面板优化**：
  - 控制面板与命令列表文案对齐当前 10 个标签页和 QuickPick 快捷操作
  - 确保所有功能描述与实际实现一致

- **分支视图（🌳 分支视图）重大优化**：
  - **增量更新机制**：
    - 基于祖先关系智能重建分支图，检测到"旧 HEAD 是新 HEAD 的祖先"时只拉取 `base..HEAD` 的增量提交
    - 减少 60%+ 的 Git I/O 操作，大幅提升大仓库加载速度
    - 优化增量查找策略：从最近的提交开始查找，最多尝试 10 次，避免在大量历史中查找过久
    - 快速过滤：如果候选提交的节点数接近限制（800），自动跳过该候选
  
  - **持久化缓存系统**：
    - 基于 `branchGraph:<repoId>:<headHash>` 的持久化存储，跨会话保持
    - 维护祖先索引（最多保留 20 个提交哈希），自动清理旧数据
    - 新增 `getBranchGraphSnapshot()` 方法，控制面板初次渲染时优先使用缓存快照，实现秒开
    - 新增 `clearBranchGraphCache()` 方法，支持一键清空内存 + workspaceState 缓存
    - Webview 提供"🧹 清空分支图缓存"按钮，方便调试和强制刷新
  
  - **智能布局算法**：
    - D3.js 分层布局算法，类似 `git log --graph` 的可视化效果
    - 拓扑排序确保子节点（新提交）在父节点（旧提交）之上
    - 改进的轨道分配算法：main/master 分支始终在轨道 0（最左侧）
    - 智能处理分支分叉和合并，为不同分支分配不同轨道，避免重叠
    - 支持多分支共享提交的正确显示
  
  - **LOD（Level of Detail）性能优化**：
    - 根据缩放级别动态调整节点和标签显示详细程度
    - 缩放 < 0.5：隐藏所有标签，缩小节点（合并节点 r=4，普通节点 r=3）
    - 缩放 0.5-1.0：只显示哈希标签，隐藏消息标签，节点中等（合并节点 r=6，普通节点 r=5）
    - 缩放 > 1.0：显示所有标签，节点正常大小（合并节点 r=8，普通节点 r=6）
    - 大幅提升大仓库下的交互流畅度（60fps）
  
  - **交互功能增强**：
    - **缩放控制**：鼠标滚轮缩放（0.05x - 5x），缩放控制按钮（+/-/适应窗口），实时显示缩放百分比
    - **平移功能**：拖拽空白区域平移视图，支持滚动查看超出可视区域的内容
    - **节点拖拽**：点击并拖拽节点调整位置，连线自动跟随，释放后保持新位置
    - **详情面板**：点击节点显示右侧详情面板（300px 宽），包含完整提交信息：
      - 提交哈希（完整，可复制，monospace 字体）
      - 完整提交消息（支持多行，white-space: pre-wrap）
      - 作者信息（姓名和邮箱）
      - 提交时间（绝对时间和相对时间）
      - 所属分支列表（当前分支高亮显示，带"(当前)"标识）
      - 合并提交特殊标记（🔀 合并提交，背景色 rgba(249, 168, 37, 0.1)）
      - 父提交列表（可点击跳转，第一个父提交在合并提交中标记为"(主分支)"）
    - **悬停工具提示**：鼠标悬停显示提交预览信息（哈希、消息、作者、日期、分支、父提交）
    - **面板布局自适应**：详情面板打开时图形区域自动缩小到 70%，关闭后恢复 100%
  
  - **节点类型识别**：
    - 蓝色小节点（半径 6px）：普通提交（只属于一个分支）
    - 绿色小节点（半径 6px）：多分支共享的提交（属于多个分支）
    - 橙色大节点（半径 8px）：合并提交（有多个父提交）
    - 图例清晰展示三种节点类型和连接线说明
  
  - **性能指标**：
    - 大量节点（100+）加载时间 < 3 秒（包括数据获取和布局计算）
    - 分层布局算法计算时间 < 2 秒（轨道分配和层级计算）
    - 交互（缩放、拖拽）流畅，无卡顿（60fps）
    - 内存占用合理（< 100MB）
    - 画布高度自动计算（Math.max(600, nodes.length * 30)），支持滚动查看
  
  - **主题适配**：
    - 自动适配 VS Code 浅色/深色主题
    - 节点颜色在深色/浅色背景下清晰可辨
    - 标签背景半透明黑色（rgba(0, 0, 0, 0.7)），提高可读性
    - 工具提示和详情面板使用主题色，自动适配
  
  - **边界情况处理**：
    - 空仓库显示友好提示
    - 单分支线性历史正确展示（所有节点在同一轨道）
    - 无提交信息时显示占位符，不报错
    - 数据加载失败有友好提示，可通过刷新按钮重试
    - 轨道分配边界情况处理（根提交、普通提交、合并提交、分叉点）

### 构建与发布 📦

- **版本标识更新**：
  - VSIX 文件名更新为 `git-assistant-1.0.1.vsix`
  - 发布脚本、测试用标签/示例文件命名统一更新为 1.0.1
  - package.json 版本号已更新

- **Webpack 构建优化**：
  - 支持生产/开发模式区分
  - 代码压缩和性能提示配置
  - 自动清理输出目录

### 测试覆盖 🧪

- **单元测试完善**：
  - `git-utils.test.ts` - Git 工具函数测试（12个测试用例）
  - `git-utils-conflict.test.ts` - 冲突处理测试（6个测试用例）
  - `error-handler.test.ts` - 错误处理测试（4个测试用例）
  - 测试覆盖核心工具函数和错误处理逻辑

### 已知问题 🐛

- 大型仓库（> 10k 提交）历史加载较慢（计划在后续版本优化）
- 复杂冲突的自动解决可能不准确（建议手动编辑）
- 部分 Git 操作在网络不稳定时可能超时（已添加重试机制）

### 迁移指南 🔄

从 v1.0.0 升级到 v1.0.1：

1. **配置迁移**（可选）：
   - 如果希望快速推送/拉取记住默认远程，可在 VS Code 设置中配置 `git-assistant.defaultRemote`
   - 留空则自动选择，不影响现有使用习惯

2. **功能兼容性**：
   - 所有 v1.0.0 的功能在 v1.0.1 中完全兼容
   - 新增功能为可选增强，不影响现有工作流

3. **文档更新**：
   - 建议查看更新后的文档，了解新增配置选项和 API 方法


## [1.0.0] - 2025-11-26

> 🎉 **初代正式版发布！** 包含完整的 Git 可视化管理能力，涵盖分支/远程/标签/冲突/历史等核心场景。

### 新增功能 ✨

#### Git 基础操作
- 快速推送 (Push) - `Ctrl+Alt+P`，支持推送前确认
- 快速拉取 (Pull) - `Ctrl+Alt+L`，支持自动 stash
- 克隆仓库 (Clone) - 可视化引导选择目录
- 添加文件到暂存区 - 一键全部或多选文件
- 提交更改 - 输入校验与进度提示
- 操作前安全检查（未保存文件、未提交改动、冲突检测）
- 操作进度显示与错误回滚

#### 仓库初始化向导
- 一站式执行 `git init → git remote add → git add . → git commit → git push`
- 适合空目录快速搭建远程仓库

#### 分支管理
- 分支树视图（本地/远程分组）
- 创建分支（含命名校验）
- 快速切换分支 - `Ctrl+Alt+B`
- 合并分支（快进/三路合并策略可选）
- 删除分支（命令行方式，UI 中已简化）
- 分支状态标记与追踪关系
- 切换前自动 stash

#### 远程仓库管理
- 远程列表展示（fetch/push 地址）
- 添加/重命名/更新 URL/删除远程
- 控制面板内即可完成所有操作

#### 标签管理
- 创建带注释/轻量标签
- 指定提交打标签
- 推送单个/全部标签
- 强制覆盖远程标签
- 删除本地/远程标签
- 批量解析（`git for-each-ref`）提升加载速度

#### 提交历史可视化
- **2D 提交图谱**：
  - D3.js 力导向图布局
  - 高 DPI 支持，字体清晰锐利
  - 自动换行、颜色增强、节点高光
  - 支持拖拽和缩放
- **热力图分析**：
  - 文件修改频率统计
  - 贡献者活跃度分析
  - 浅色/深色主题自适应
- **分支视图**：
  - 可视化分支合并路径
  - 箭头表示合并方向
  - 高亮当前分支
- **时间线视图**：
  - 日历热力图（#0e639c 统一配色）
  - 柱状图展示每日提交
  - 支持年月切换
  - 浅色/深色主题自适应
- **历史浏览**：
  - 提交列表视图
  - 提交详情面板
  - 相对时间显示

#### 冲突检测与解决
- 实时冲突检测（TreeDataProvider + 文件监听）
- 冲突文件列表与数量统计
- 三栏对比编辑器（当前/传入/结果）
- 三种解决方案：接受当前、接受传入、接受全部
- 手动编辑支持、撤销/重做

#### 可视化控制面板
- **10 个功能标签页**（固定顺序，按钮宽度 120px）：
  1. 📋 快捷指令 - 命令历史、复制/重试、清空
  2. 📚 Git 指令集 - 常用命令学习卡片
  3. 🌿 分支管理 - 分支树、创建/切换/合并
  4. ☁️ 远程仓库 - 添加/重命名/更新/删除
  5. 🏷️ 标签管理 - 创建/推送/删除标签
  6. 🌳 分支视图 - 分支关系可视化
  7. ⚠️ 冲突解决 - 冲突列表与三栏对比
  8. 📊 提交图谱 - 高 DPI 2D 图谱
  9. 📅 时间线 - 日历热力图 + 柱状图
  10. 🔥 热力图 - 文件/贡献者统计
- 实时数据刷新
- 状态栏入口

#### 配置选项
- `git-assistant.autoFetch` - 自动获取远程分支更新
- `git-assistant.confirmPush` - 推送前确认
- `git-assistant.maxHistoryCount` - 历史记录数量
- `git-assistant.conflictHighlight` - 冲突高亮

### 性能优化 🚀

- **Promise.allSettled 并行刷新**：状态/分支/日志/远程/标签同时抓取，基础面板 < 400ms
- **标签批量解析**：`git for-each-ref` 一次取回全部元数据，Tag Manager 加载提速 3-5 倍
- **前端快速回执**：Webview 先推送基础数据、再推送统计信息，避免长时间空白
- **容错与降级**：单个 Git 命令失败不阻塞面板刷新，自动 fallback 至默认数据
- **文件监听优化**：只观察 `.git/HEAD` 与 `refs/heads/**`，配合 300ms 防抖

### 技术架构

- **前端技术栈**：
  - TypeScript + React 18
  - D3.js 数据可视化
  - Three.js + React Three Fiber（实验性 3D 图谱）
  - CSS 复用 VS Code 主题变量
- **后端技术栈**：
  - simple-git 封装 Git 操作
  - VS Code Extension API
  - Webpack 5 模块打包
  - 完整的 TypeScript 类型定义

### 已知问题 🐛

- 大型仓库（> 10k 提交）历史加载较慢
- 复杂冲突的自动解决可能不准确
- 部分 Git 操作在网络不稳定时可能超时

### 文档 📝

- README.md - 项目介绍
- README_CN.md - 中文详细文档
- QUICK_REFERENCE.md - 功能速查表
- PROJECT_OVERVIEW.md - 架构概览
- GETTING_STARTED.md - 快速上手
- CHANGELOG.md - 更新日志
- CONTRIBUTING.md - 贡献指南
- docs/DEVELOPMENT.md - 开发文档
- docs/QUICKSTART.md - 5 分钟入门
- docs/TESTING.md - 测试指南

---

## 版本说明

### 版本号规则
遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范：
- 主版本号：不兼容的 API 修改
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

### 变更类型
- `新增` - 新功能
- `修改` - 现有功能的变更
- `弃用` - 即将移除的功能
- `移除` - 已移除的功能
- `修复` - 问题修复
- `安全` - 安全相关的修复

### 日期格式
采用 ISO 8601 格式：YYYY-MM-DD

---

更多信息请访问：[GitHub Releases](https://github.com/YIXUAN-oss/CodeGitAssistant/releases)
